# ------------------------------
# Goal driven Parallel Sequences
# ------------------------------
#
# See https://www.sciencedirect.com/science/article/pii/S1532046421000794
# and https://github.com/hongsun502/wstLogic/tree/master

@prefix math: <http://www.w3.org/2000/10/swap/math#>.
@prefix list: <http://www.w3.org/2000/10/swap/list#>.
@prefix gps: <https://eyereasoner.github.io/eye/reasoning/gps/gps-schema#>.
@prefix : <https://eyereasoner.github.io/eye/reasoning#>.

# ---------------------
# Data (a small sample)
# ---------------------

# current state
:i1 :location :Gent.

# map of Belgium
(:Gent :Brugge   :drive_gent_brugge     1500.0 0.006 0.96 0.99) :edge true .
(:Gent :Kortrijk :drive_gent_kortrijk   1600.0 0.007 0.96 0.99) :edge true .
(:Kortrijk :Brugge :drive_kortrijk_brugge 1600.0 0.007 0.96 0.99) :edge true .
(:Brugge :Oostende :drive_brugge_oostende  900.0 0.004 0.98 1.0) :edge true .

# ----------------
# Path computation
# ----------------

# Base: one edge is a path
{
  (?From ?To (?Act) ?Dur ?Cost ?Belief ?Comfort) :path true.
}
<=
{
  (?From ?To ?Act ?Dur ?Cost ?Belief ?Comfort) :edge true.
}.

# Recursive: edge + path => path, aggregate weights, concatenate action list
{
  (?From ?To ?Acts ?Dur ?Cost ?Belief ?Comfort) :path true.
}
<=
{
  (?From ?Mid ?Act ?Dur1 ?Cost1 ?Bel1 ?Comf1) :edge true.
  (?Mid ?To ?RestActs ?Dur2 ?Cost2 ?Bel2 ?Comf2) :path true.

  ((?Act) ?RestActs) list:append ?Acts.

  (?Dur1  ?Dur2)  math:sum     ?Dur.
  (?Cost1 ?Cost2) math:sum     ?Cost.
  (?Bel1  ?Bel2)  math:product ?Belief.
  (?Comf1 ?Comf2) math:product ?Comfort.
}.

# -------------------------
# Query: only paths to goal
# -------------------------

{
  :i1 :location ?Start.
  (?Start :Oostende ?Acts ?Dur ?Cost ?Bel ?Comf) :path true.
}
=>
{
  :i1 gps:path (?Acts ?Dur ?Cost ?Bel ?Comf).
}.

